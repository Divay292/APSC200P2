function [allData, scenario, sensors] = Demostration1()
%Demostration1 - Returns sensor detections
%    allData = Demostration1 returns sensor detections in a structure
%    with time for an internally defined scenario and sensor suite.
%
%    [allData, scenario, sensors] = Demostration1 optionally returns
%    the drivingScenario and detection generator objects.

% Generated by MATLAB(R) 9.9 (R2020b) and Automated Driving Toolbox 3.2 (R2020b).
% Generated on: 03-Apr-2021 14:23:42

% Create the drivingScenario object and ego car
[scenario, egoVehicle] = createDrivingScenario;

% Create all the sensors
[sensors, numSensors] = createSensors(scenario);

allData = struct('Time', {}, 'ActorPoses', {}, 'ObjectDetections', {}, 'LaneDetections', {}, 'PointClouds', {});
running = true;

scenario.StopTime = 300;
[textField, hTopViewAxes] = plotScenario(scenario,egoVehicle);

objectArray = [];
delta = 8;

while running
    
    % Generate the target poses of all actors relative to the ego vehicle
    poses = targetPoses(egoVehicle);
    time  = scenario.SimulationTime;
    
    objectDetections = {};
    laneDetections   = [];
    ptClouds = {};
    isValidTime = false(1, numSensors);
    isValidLaneTime = false(1, numSensors);
    isValidPointCloudTime = false(1, numSensors);
    
    % Generate detections for each sensor
    for sensorIndex = 1:numSensors
        sensor = sensors{sensorIndex};
        % Generate the ego vehicle lane boundaries
        maxLaneDetectionRange = min(500,sensor.MaxRange);
        lanes = laneBoundaries(egoVehicle, 'XDistance', linspace(-maxLaneDetectionRange, maxLaneDetectionRange, 101));
        type = getDetectorOutput(sensor);
        if strcmp(type, 'Objects only')
            [objectDets, numObjects, isValidTime(sensorIndex)] = sensor(poses, time);
            objectDetections = [objectDetections; objectDets(1:numObjects)]; %#ok<AGROW>
        elseif strcmp(type, 'Lanes only')
            [laneDets, ~, isValidTime(sensorIndex)] = sensor(lanes, time);
            laneDetections   = [laneDetections laneDets]; %#ok<AGROW>
        elseif strcmp(type, 'Lanes and objects')
            [objectDets, numObjects, isValidTime(sensorIndex), laneDets, ~, isValidLaneTime(sensorIndex)] = sensor(poses, lanes, time);
            objectDetections = [objectDetections; objectDets(1:numObjects)]; %#ok<AGROW>
            laneDetections   = [laneDetections laneDets]; %#ok<AGROW>
        elseif strcmp(type, 'Lanes with occlusion')
            [laneDets, ~, isValidLaneTime(sensorIndex)] = sensor(poses, lanes, time);
            laneDetections   = [laneDetections laneDets]; %#ok<AGROW>
        elseif strcmp(type, 'PointCloud')
            if sensor.HasRoadsInputPort
                rdmesh = roadMesh(egoVehicle,min(500,sensor.MaxRange));
                [ptCloud, isValidPointCloudTime(sensorIndex)] = sensor(poses, rdmesh, time);
            else
                [ptCloud, isValidPointCloudTime(sensorIndex)] = sensor(poses, time);
            end
            ptClouds = [ptClouds; ptCloud]; %#ok<AGROW>
        end
    end
    
    % Aggregate all detections into a structure for later use
    if any(isValidTime) || any(isValidLaneTime) || any(isValidPointCloudTime)
        allData(end + 1) = struct( ...
            'Time',       scenario.SimulationTime, ...
            'ActorPoses', actorPoses(scenario), ...
            'ObjectDetections', {objectDetections}, ...
            'LaneDetections', {laneDetections}, ...
            'PointClouds',   {ptClouds}); %#ok<AGROW>
    end
    
    if any(isValidTime) || any(isValidLaneTime) || any(isValidPointCloudTime)
        objects = objectDetections;
        objectStruct = [objects{:}];
        allPosInertial = vehicle2Inertial(objects, egoVehicle);
        disp('Class ids: %i\n')
        disp([objectStruct.ObjectClassID])
        
        plot3(allPosInertial(1,:), allPosInertial(2,:),allPosInertial(3,:),'b.', 'Parent', hTopViewAxes);
        
        message = sprintf('Number of objects sampled in one time step: %i\n', length(objects));
        textField.String = message;
    end
    
    % Advance the scenario one time step and exit the loop if the scenario is complete
    running = advance(scenario);
end

% Restart the driving scenario to return the actors to their initial positions.
restart(scenario);

% Release all the sensor objects so they can be used again.
for sensorIndex = 1:numSensors
    release(sensors{sensorIndex});
end

%%%%%%%%%%%%%%%%%%%%
% Helper functions %
%%%%%%%%%%%%%%%%%%%%

% Units used in createSensors and createDrivingScenario
% Distance/Position - meters
% Speed             - meters/second
% Angles            - degrees
% RCS Pattern       - dBsm

function [sensors, numSensors] = createSensors(scenario)
% createSensors Returns all sensor objects to generate detections

% Assign into each sensor the physical and radar profiles for all actors
profiles = actorProfiles(scenario);
sensors{1} = visionDetectionGenerator('SensorIndex', 1, ...
    'SensorLocation', [-1 0], ...
    'Yaw', -180, ...
    'MaxRange', 100, ...
    'DetectorOutput', 'Objects only', ...
    'Intrinsics', cameraIntrinsics([1814.81018227767 1814.81018227767],[320 240],[480 640]), ...
    'ActorProfiles', profiles);
sensors{2} = visionDetectionGenerator('SensorIndex', 2, ...
    'SensorLocation', [2 0], ...
    'MaxRange', 100, ...
    'DetectorOutput', 'Objects only', ...
    'Intrinsics', cameraIntrinsics([1814.81018227767 1814.81018227767],[320 240],[480 640]), ...
    'ActorProfiles', profiles);
sensors{3} = visionDetectionGenerator('SensorIndex', 3, ...
    'SensorLocation', [1.1 0.9], ...
    'Yaw', 90, ...
    'MaxRange', 50, ...
    'DetectorOutput', 'Objects only', ...
    'Intrinsics', cameraIntrinsics([320 320],[320 240],[480 640]), ...
    'ActorProfiles', profiles);
sensors{4} = visionDetectionGenerator('SensorIndex', 4, ...
    'SensorLocation', [1.1 -0.9], ...
    'Yaw', -90, ...
    'MaxRange', 50, ...
    'DetectorOutput', 'Objects only', ...
    'Intrinsics', cameraIntrinsics([320 320],[320 240],[480 640]), ...
    'ActorProfiles', profiles);
sensors{5} = radarDetectionGenerator('SensorIndex', 5, ...
    'SensorLocation', [0 -0.9], ...
    'Yaw', -90, ...
    'MaxRange', 50, ...
    'FieldOfView', [90 5], ...
    'ActorProfiles', profiles);
sensors{6} = radarDetectionGenerator('SensorIndex', 6, ...
    'SensorLocation', [0 0.9], ...
    'Yaw', 90, ...
    'MaxRange', 50, ...
    'FieldOfView', [90 5], ...
    'ActorProfiles', profiles);
sensors{7} = lidarPointCloudGenerator('SensorIndex', 7, ...
    'SensorLocation', [0.2 0], ...
    'EgoVehicleActorID', 55, ...
    'ActorProfiles', profiles);
numSensors = 7;

function [scenario, egoVehicle] = createDrivingScenario
% createDrivingScenario Returns the drivingScenario defined in the Designer

% Construct a drivingScenario object.
scenario = drivingScenario;

% Add all road segments
roadCenters = [201.6 -199.2 0;
    199.7 -42.7 0;
    172.7 -9.3 0;
    -30.5 -7 0;
    -51 -39.7 0;
    -52.1 -245.9 0;
    -33.1 -268.3 0;
    179.5 -270.6 0;
    200.8 -246.3 0;
    201.6 -199.2 0];
laneSpecification = lanespec(2);
road(scenario, roadCenters, 'Lanes', laneSpecification, 'Name', 'Road');

roadCenters = [202.7 -199.2 0;
    136.6 -193.9 0;
    106 -63.5 0];
road(scenario, roadCenters, 'Name', 'Road1');

roadCenters = [60 35.2 0;
    68.1 -307.1 0];
road(scenario, roadCenters, 'Name', 'Road2');

roadCenters = [-80.1 -179.9 0;
    63.3 -163.2 0;
    169.9 -278 0];
road(scenario, roadCenters, 'Name', 'Road3');

roadCenters = [105.2 -67.7 0;
    129.1 -42.8 0;
    165.3 -77.4 0;
    170.5 -141.4 0;
    136.6 -193.5 0];
road(scenario, roadCenters, 'Name', 'Road4');

roadCenters = [-51 -39.2 0;
    40.9 -39.7 0];
road(scenario, roadCenters, 'Name', 'Road5');

roadCenters = [40.9 -38.7 0;
    39.4 -126.9 0];
road(scenario, roadCenters, 'Name', 'Road6');

roadCenters = [38.8 -126.4 0;
    -38.4 -127.4 0];
road(scenario, roadCenters, 'Name', 'Road7');

roadCenters = [-39 -127.4 0;
    -35.8 -39.7 0];
road(scenario, roadCenters, 'Name', 'Road8');

roadCenters = [3.1 -41.4 0;
    0.7 -126.4 0];
road(scenario, roadCenters, 'Name', 'Road9');

roadCenters = [1.8 -81.9 0;
    21.9 -82.7 0];
road(scenario, roadCenters, 'Name', 'Road10');

roadCenters = [21.7 -82.4 0;
    21.9 -54.1 0];
road(scenario, roadCenters, 'Name', 'Road11');

roadCenters = [21.9 -81.9 0;
    21.1 -110 0];
road(scenario, roadCenters, 'Name', 'Road12');

roadCenters = [1 -81.6 0;
    -20.7 -80.9 0];
road(scenario, roadCenters, 'Name', 'Road13');

roadCenters = [-20.7 -80.1 0;
    -20.5 -53.8 0];
road(scenario, roadCenters, 'Name', 'Road14');

roadCenters = [-20.5 -80.3 0;
    -21.5 -110.3 0];
road(scenario, roadCenters, 'Name', 'Road15');

% Add the actors
actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [157.9 -86.1 0], ...
    'Yaw', 15, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [162.7 -105.7 0], ...
    'Yaw', 11, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House1');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [163.7 -126 0], ...
    'Yaw', -7, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House2');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [159.6 -144.5 0], ...
    'Yaw', -18, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House3');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [150.5 -161.5 0], ...
    'Yaw', -36, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House4');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [152.5 -69.9 0], ...
    'Yaw', 21, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House5');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [141.7 -55.3 0], ...
    'Yaw', 48, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House6');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [120 -59.4 0], ...
    'Yaw', 139, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House7');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [110.6 -78.6 0], ...
    'Yaw', 164, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House8');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [108.6 -99.3 0], ...
    'Yaw', 175, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House9');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [108.2 -120.6 0], ...
    'Yaw', 179, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House10');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [110.6 -140.9 0], ...
    'Yaw', -167, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House11');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [117.3 -160.1 0], ...
    'Yaw', -153, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House12');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [129.5 -177.6 0], ...
    'Yaw', -132, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House13');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [178.8 -191.4 0], ...
    'Yaw', -86, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House14');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [181.7 -210.7 0], ...
    'Yaw', 93, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House15');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [156.5 -210.3 0], ...
    'Yaw', 82, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House16');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [182.6 -114.7 0], ...
    'Yaw', -174, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House17');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [180.4 -137.7 0], ...
    'Yaw', 166, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House18');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [170.9 -160.8 0], ...
    'Yaw', 153, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House19');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [178.8 -91.2 0], ...
    'Yaw', -166, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House20');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [173.5 -73 0], ...
    'Yaw', -157, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House21');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [165.1 -52.4 0], ...
    'Yaw', -148, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House22');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [124.8 -33.9 0], ...
    'Yaw', -76, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House23');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [98 -62.8 0], ...
    'Yaw', -17, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House24');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [89.8 -106.5 0], ...
    'Yaw', -3, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House25');

actor(scenario, ...
    'ClassID', 6, ...
    'Length', 12, ...
    'Width', 10, ...
    'Height', 6, ...
    'Position', [90.1 -134.4 0], ...
    'Yaw', -1, ...
    'PlotColor', [255 255 17] / 255, ...
    'Name', 'House26');

actor(scenario, ...
    'ClassID', 8, ...
    'Length', 25, ...
    'Width', 20, ...
    'Height', 30, ...
    'Position', [82.2 -212.6 0], ...
    'Yaw', -178, ...
    'Name', 'Apartments');

actor(scenario, ...
    'ClassID', 8, ...
    'Length', 25, ...
    'Width', 20, ...
    'Height', 30, ...
    'Position', [82.8 -243.8 0], ...
    'Yaw', -178, ...
    'PlotColor', [0.635 0.078 0.184], ...
    'Name', 'Apartments1');

actor(scenario, ...
    'ClassID', 8, ...
    'Length', 25, ...
    'Width', 20, ...
    'Height', 30, ...
    'Position', [83.2 -277.8 0], ...
    'Yaw', -178, ...
    'PlotColor', [0.635 0.078 0.184], ...
    'Name', 'Apartments2');

actor(scenario, ...
    'ClassID', 8, ...
    'Length', 25, ...
    'Width', 20, ...
    'Height', 30, ...
    'Position', [49.9 -212 0], ...
    'Yaw', 2, ...
    'PlotColor', [0.635 0.078 0.184], ...
    'Name', 'Apartments3');

actor(scenario, ...
    'ClassID', 8, ...
    'Length', 25, ...
    'Width', 20, ...
    'Height', 30, ...
    'Position', [50.9 -243.8 0], ...
    'Yaw', 1, ...
    'PlotColor', [0.635 0.078 0.184], ...
    'Name', 'Apartments4');

actor(scenario, ...
    'ClassID', 8, ...
    'Length', 25, ...
    'Width', 20, ...
    'Height', 30, ...
    'Position', [51 -277.8 0], ...
    'Yaw', 2, ...
    'PlotColor', [0.635 0.078 0.184], ...
    'Name', 'Apartments5');

actor(scenario, ...
    'ClassID', 8, ...
    'Length', 25, ...
    'Width', 20, ...
    'Height', 30, ...
    'Position', [130.8 -242.3 0], ...
    'Yaw', 33, ...
    'PlotColor', [0.635 0.078 0.184], ...
    'Name', 'Apartments6');

actor(scenario, ...
    'ClassID', 8, ...
    'Length', 25, ...
    'Width', 20, ...
    'Height', 30, ...
    'Position', [25.3 -172.9 0], ...
    'Yaw', 87, ...
    'Name', 'Apartments7');

actor(scenario, ...
    'ClassID', 8, ...
    'Length', 25, ...
    'Width', 20, ...
    'Height', 30, ...
    'Position', [-29.1 -180.8 0], ...
    'Yaw', 107, ...
    'PlotColor', [0.635 0.078 0.184], ...
    'Name', 'Apartments8');

actor(scenario, ...
    'ClassID', 8, ...
    'Length', 25, ...
    'Width', 20, ...
    'Height', 30, ...
    'Position', [-19.5 -258.4 0], ...
    'Yaw', -132, ...
    'PlotColor', [0.635 0.078 0.184], ...
    'Name', 'Apartments9');

actor(scenario, ...
    'ClassID', 9, ...
    'Length', 10, ...
    'Width', 8, ...
    'Height', 5, ...
    'Position', [27.6 -31.5 0], ...
    'Yaw', -91, ...
    'Name', 'Commercial');

actor(scenario, ...
    'ClassID', 9, ...
    'Length', 10, ...
    'Width', 8, ...
    'Height', 5, ...
    'Position', [10.6 -31.3 0], ...
    'Yaw', -91, ...
    'PlotColor', [0.929 0.694 0.125], ...
    'Name', 'Commercial1');

actor(scenario, ...
    'ClassID', 9, ...
    'Length', 10, ...
    'Width', 8, ...
    'Height', 5, ...
    'Position', [-8 -30.9 0], ...
    'Yaw', -91, ...
    'PlotColor', [0.929 0.694 0.125], ...
    'Name', 'Commercial2');

actor(scenario, ...
    'ClassID', 9, ...
    'Length', 10, ...
    'Width', 8, ...
    'Height', 5, ...
    'Position', [48.9 -56.7 0], ...
    'Yaw', -177, ...
    'PlotColor', [0.929 0.694 0.125], ...
    'Name', 'Commercial3');

actor(scenario, ...
    'ClassID', 9, ...
    'Length', 10, ...
    'Width', 8, ...
    'Height', 5, ...
    'Position', [48.7 -78.2 0], ...
    'Yaw', -180, ...
    'PlotColor', [0.929 0.694 0.125], ...
    'Name', 'Commercial4');

actor(scenario, ...
    'ClassID', 9, ...
    'Length', 10, ...
    'Width', 8, ...
    'Height', 5, ...
    'Position', [48.2 -100.2 0], ...
    'Yaw', 178, ...
    'PlotColor', [0.929 0.694 0.125], ...
    'Name', 'Commercial5');

actor(scenario, ...
    'ClassID', 9, ...
    'Length', 10, ...
    'Width', 8, ...
    'Height', 5, ...
    'Position', [46.9 -119.3 0], ...
    'Yaw', 180, ...
    'PlotColor', [0.929 0.694 0.125], ...
    'Name', 'Commercial6');

actor(scenario, ...
    'ClassID', 9, ...
    'Length', 10, ...
    'Width', 8, ...
    'Height', 5, ...
    'Position', [17.1 -135.4 0], ...
    'Yaw', 89, ...
    'Name', 'Commercial7');

actor(scenario, ...
    'ClassID', 9, ...
    'Length', 10, ...
    'Width', 8, ...
    'Height', 5, ...
    'Position', [-12 -135.5 0], ...
    'Yaw', 89, ...
    'PlotColor', [0.929 0.694 0.125], ...
    'Name', 'Commercial8');

vehicle(scenario, ...
    'ClassID', 1, ...
    'Position', [15.3 -57.3 0], ...
    'Mesh', driving.scenario.carMesh, ...
    'Name', 'Car');

vehicle(scenario, ...
    'ClassID', 1, ...
    'Position', [15.3 -60.5 0], ...
    'Mesh', driving.scenario.carMesh, ...
    'PlotColor', [0.466 0.674 0.188], ...
    'Name', 'Car1');

vehicle(scenario, ...
    'ClassID', 1, ...
    'Position', [15.3 -63.7 0], ...
    'Mesh', driving.scenario.carMesh, ...
    'PlotColor', [0.466 0.674 0.188], ...
    'Name', 'Car2');

vehicle(scenario, ...
    'ClassID', 1, ...
    'Position', [14.7 -67.1 0], ...
    'Mesh', driving.scenario.carMesh, ...
    'PlotColor', [0.466 0.674 0.188], ...
    'Name', 'Car3');

truck = vehicle(scenario, ...
    'ClassID', 2, ...
    'Length', 8.2, ...
    'Width', 2.5, ...
    'Height', 3.5, ...
    'Position', [53.7 37.1 0], ...
    'Mesh', driving.scenario.truckMesh, ...
    'Name', 'Truck');
waypoints = [53.4 37.5 0;
    90.3 34.1 0;
    139.7 17.1 0;
    180.8 -16.2 0;
    205.7 -53.8 0;
    212.3 -94.8 0;
    202.4 -169 0;
    203.5 -225 0;
    199.6 -251 0;
    155.3 -286.5 0;
    99.3 -306.4 0;
    28.4 -303.1 0;
    -32.5 -270.4 0;
    -66.8 -220.5 0;
    -77.9 -187.3 0;
    -80.7 -144.1 0;
    -70.7 -82.1 0;
    -50.2 -36.1 0;
    -31.5 -7.4 0;
    -17.9 3.6 0;
    -12.6 10.7 0;
    -4.2 14.3 0;
    -4.2 14.9 0;
    4.4 21.7 0;
    21.8 28.1 0;
    54.5 38.7 0];
speed = [30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30];
trajectory(truck, waypoints, speed);

car4 = vehicle(scenario, ...
    'ClassID', 1, ...
    'Position', [60.8 28.9 0], ...
    'Mesh', driving.scenario.carMesh, ...
    'Name', 'Car4');
waypoints = [60.8 28.9 0;
    61.8 -24.1 0;
    64.6 -145.9 0;
    65.6 -192.8 0;
    69.2 -308 0];
speed = [30;30;30;30;30];
trajectory(car4, waypoints, speed);

car5 = vehicle(scenario, ...
    'ClassID', 1, ...
    'Position', [168.3 -272.6 0], ...
    'Mesh', driving.scenario.carMesh, ...
    'Name', 'Car5');
waypoints = [168.3 -272.6 0;
    143.8 -233.9 0;
    112.2 -193.1 0;
    75.2 -167.5 0;
    40.3 -155 0;
    -1.6 -157.1 0;
    -50.7 -167.5 0;
    -74.6 -177.8 0];
speed = [30;30;30;30;30;30;30;30];
trajectory(car5, waypoints, speed);

vehicle(scenario, ...
    'ClassID', 10, ...
    'Height', 0.1, ...
    'Position', [68.3 -140.3 0], ...
    'PlotColor', [255 0 0] / 255, ...
    'Name', 'ERV hub');

% Add the ego vehicle
egoVehicle = vehicle(scenario, ...
    'ClassID', 11, ...
    'Length', 3, ...
    'Position', [69.14 -138.21 0], ...
    'Mesh', driving.scenario.carMesh, ...
    'Name', 'ERV');
waypoints = [69.14 -138.21 0;
    61.9 -138.3 0;
    63.2 -141.8 0;
    63.8 -149.1 0;
    63.6 -164.6 0;
    77.7 -170.2 0;
    98.4 -183.4 0;
    126.4 -211 0;
    151.4 -248.4 0;
    161 -264.3 0;
    168.9 -277.5 0;
    185.8 -268.5 0;
    198.2 -254.6 0;
    205.5 -224.5 0;
    205.1 -209.9 0;
    203.2 -200.2 0;
    194.5 -200.7 0;
    181.7 -201.1 0;
    156.6 -200.2 0;
    139.7 -194.3 0;
    122.8 -183.8 0;
    112.7 -168.2 0;
    103.6 -145.4 0;
    99.4 -125.3 0;
    103.1 -75 0];
speed = [30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30;30];
trajectory(egoVehicle, waypoints, speed);

function output = getDetectorOutput(sensor)

if isa(sensor, 'visionDetectionGenerator')
    output = sensor.DetectorOutput;
elseif isa(sensor, 'lidarPointCloudGenerator')
    output = 'PointCloud';
else
    output = 'Objects only';
end

